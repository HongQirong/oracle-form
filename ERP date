SELECT DECODE((SELECT terminal_id
                 FROM fnd_logins
                WHERE login_id = fnd_global.login_id)
             ,'useless', NULL
             ,'Concurrent', TRUNC(SYSDATE
                                 ,'MM')
             ,TO_CHAR(TRUNC(SYSDATE
                           ,'MM')
                     ,p.profile_option_value))
          trs_reference_s
  FROM (SELECT v.profile_option_value
              ,v.level_id
              ,ROW_NUMBER() OVER (ORDER BY v.level_id DESC) level_seq
          FROM fnd_profile_options_vl l
              ,fnd_profile_option_values v
         WHERE 1 = 1
               AND l.profile_option_id = v.profile_option_id
               AND v.level_value IN (0
                                    ,fnd_global.resp_appl_id
                                    ,fnd_global.resp_id
                                    ,fnd_global.user_id)
               AND v.level_id IN (10001
                                 ,10002
                                 ,10003
                                 ,10004)
               AND l.profile_option_id = &profile_option_id
               AND l.application_id = &application_id
               AND 1 = 1) p
 WHERE level_seq = 1
